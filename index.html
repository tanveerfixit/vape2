<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Order Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-100 text-slate-800 antialiased">

<main class="p-2 md:p-4 grid grid-cols-1 lg:grid-cols-3 gap-3 md:gap-4">

  <!-- PRODUCT INPUT -->
  <section class="lg:col-span-2 space-y-3">

    <div class="bg-white rounded-lg shadow-sm p-3 md:p-4">
      <h2 class="font-bold text-lg mb-3 border-b pb-2">New Item</h2>

      <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-3">
        <div class="flex flex-col">
            <label class="text-[10px] uppercase font-bold text-slate-400 mb-1 ml-1">Category</label>
            <select id="category" class="border p-3 rounded-lg bg-slate-50 text-sm focus:ring-2 focus:ring-green-500 outline-none"></select>
        </div>
        <div class="flex flex-col">
            <label class="text-[10px] uppercase font-bold text-slate-400 mb-1 ml-1">Brand</label>
            <select id="brand" class="border p-3 rounded-lg bg-slate-50 text-sm focus:ring-2 focus:ring-green-500 outline-none"></select>
        </div>
        <div class="flex flex-col">
            <label class="text-[10px] uppercase font-bold text-slate-400 mb-1 ml-1">Model/Line</label>
            <select id="line" class="border p-3 rounded-lg bg-slate-50 text-sm focus:ring-2 focus:ring-green-500 outline-none"></select>
        </div>
        <div class="flex flex-col">
          <label class="text-[10px] uppercase font-bold text-slate-400 mb-1 ml-1">Flavor</label>
          <input id="flavour" list="flavourList"
            placeholder="Search or type flavor..."
            class="border p-3 rounded-lg bg-slate-50 text-sm focus:ring-2 focus:ring-green-500 outline-none w-full">
          <p id="flavourHint" class="text-[10px] text-slate-500 mt-1 ml-1 h-3"></p>
        </div>
      </div>

      <div class="flex gap-2">
        <div class="flex flex-col w-24">
            <label class="text-[10px] uppercase font-bold text-slate-400 mb-1 ml-1">Quantity</label>
            <input id="qty" type="number" min="1" value="1"
            class="border p-3 rounded-lg bg-slate-50 text-center font-bold focus:ring-2 focus:ring-green-500 outline-none">
        </div>
        <button onclick="addToOrder()"
          class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg shadow-md active:scale-95 transition-transform mt-5">
          Add to Order
        </button>
      </div>
    </div>

    <!-- ORDER TABLE -->
    <div class="bg-white rounded-lg shadow-sm overflow-hidden">
      <div class="p-3 border-b flex justify-between items-center bg-white">
        <h2 class="font-bold">Current Items</h2>
        <span id="itemCount" class="bg-slate-100 text-slate-600 text-xs px-2 py-1 rounded-full font-bold">0 Items</span>
      </div>

      <div class="overflow-x-auto">
          <table class="w-full text-xs md:text-sm">
            <thead class="bg-slate-50 text-slate-500 border-b">
              <tr>
                <th class="p-3 text-left w-8">#</th>
                <th class="p-3 text-left">Product</th>
                <th class="p-3 text-left">Flavor</th>
                <th class="p-3 text-right">Qty</th>
              </tr>
            </thead>
            <tbody id="orderTable" class="divide-y">
                <tr>
                    <td colspan="4" class="p-8 text-center text-slate-400 italic">No items added yet.</td>
                </tr>
            </tbody>
          </table>
      </div>
    </div>

  </section>

  <!-- COPY ORDER -->
  <aside>
    <div class="bg-white rounded-lg shadow-sm p-3 md:p-4 sticky top-4">
      <h2 class="font-bold mb-3">Order Summary</h2>

      <textarea id="orderOutput" rows="10" readonly
        class="w-full border border-slate-200 p-3 rounded-lg text-xs bg-slate-50 font-mono focus:outline-none focus:ring-0" 
        placeholder="Format for WhatsApp will appear here..."></textarea>

      <button onclick="copyOrder()"
        class="mt-3 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-lg shadow-md flex items-center justify-center gap-2 active:scale-95 transition-transform">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
        Copy for WhatsApp
      </button>

      <div id="msgContainer" class="hidden mt-3 p-2 bg-green-50 border border-green-200 rounded text-center">
         <p id="msg" class="text-xs text-green-700 font-bold"></p>
      </div>
    </div>
  </aside>

</main>

<script>
/* PRODUCT DATABASE */
const products = [
  { category: "Disposable Vape", brand: "Lost Mary", line: "BM6000" },
  { category: "Disposable Vape", brand: "IVG", line: "Smart 5500" },
  { category: "Disposable Vape", brand: "Elf Bar", line: "BC5000" },
  { category: "E-Liquid (Nic Salt)", brand: "ELFLIQ", line: "Nic Salts Series" }
];

/* FLAVOUR SUGGESTIONS */
const flavourSuggestions = [
  "Lemon Lime", "Pink Lemonade", "Orange", "Blood Orange", "Grapefruit", "Lemon Ice",
  "Blue Razz Lemonade", "Blueberry", "Blueberry Ice", "Blueberry Sour Raspberry", 
  "Mixed Berries", "Blackcurrant", "Blackcurrant Ice", "Raspberry", "Raspberry Ice",
  "Strawberry Ice", "Strawberry Kiwi", "Strawberry Raspberry", "Strawberry Watermelon", "Strawberry Banana",
  "Mango", "Mango Ice", "Pineapple Ice", "Kiwi Passion Fruit Guava", "Passion Fruit", "Peach Ice", "Peach Mango", "Watermelon Ice",
  "Grape", "Grape Ice", "Green Apple", "Sour Apple", "Double Apple",
  "Cherry Cola", "Cola Ice", "Energy Drink", "Pink Energy",
  "Menthol", "Fresh Mint", "Spearmint", "Cool Mint", "Ice Mint",
  "Banana Ice", "Banana Strawberry", "Cotton Candy", "Bubblegum",
  "Summer Grape", "Tropical Punch", "Rainbow Candy"
];

/* STATE */
let order = [];

/* INIT SELECTORS */
const categoryEl = document.getElementById("category");
const brandEl = document.getElementById("brand");
const lineEl = document.getElementById("line");
const flavourEl = document.getElementById("flavour");
const flavourHint = document.getElementById("flavourHint");
const qtyEl = document.getElementById("qty");
const orderTable = document.getElementById("orderTable");
const orderOutput = document.getElementById("orderOutput");
const msg = document.getElementById("msg");
const msgContainer = document.getElementById("msgContainer");
const itemCountEl = document.getElementById("itemCount");

function unique(arr, key) {
  return [...new Set(arr.map(i => i[key]))];
}
function fill(el, values) {
  el.innerHTML = values.map(v => `<option value="${v}">${v}</option>`).join("");
}

function init() {
  fill(categoryEl, unique(products, "category"));
  categoryEl.onchange = updateBrands;
  brandEl.onchange = updateLines;
  updateBrands();
}

function updateBrands() {
  fill(brandEl, unique(products.filter(p => p.category === categoryEl.value), "brand"));
  updateLines();
}

function updateLines() {
  fill(lineEl, unique(products.filter(p => 
    p.category === categoryEl.value && p.brand === brandEl.value
  ), "line"));
}

/* FLAVOUR LIST */
const dl = document.createElement("datalist");
dl.id = "flavourList";
dl.innerHTML = flavourSuggestions.map(f => `<option value="${f}">`).join("");
document.body.appendChild(dl);

flavourEl.addEventListener("input", () => {
  const v = flavourEl.value.toLowerCase();
  flavourHint.textContent = 
    v && !flavourSuggestions.some(f => f.toLowerCase().includes(v))
      ? "New flavor detected"
      : "";
});

/* ORDER LOGIC */
function addToOrder() {
  if (!flavourEl.value.trim()) return;

  order.push({
    category: categoryEl.value,
    brand: brandEl.value,
    line: lineEl.value,
    flavour: flavourEl.value.trim(),
    qty: Number(qtyEl.value)
  });

  flavourEl.value = "";
  qtyEl.value = 1;
  renderOrder();
}

function renderOrder() {
  if (order.length === 0) {
      orderTable.innerHTML = `<tr><td colspan="4" class="p-8 text-center text-slate-400 italic">No items added yet.</td></tr>`;
      orderOutput.value = "";
      itemCountEl.textContent = "0 Items";
      return;
  }

  itemCountEl.textContent = `${order.length} ${order.length === 1 ? 'Item' : 'Items'}`;
  
  orderTable.innerHTML = order.map((i, idx) => `
    <tr class="hover:bg-slate-50">
      <td class="p-3 font-medium text-slate-400">${idx + 1}</td>
      <td class="p-3">
        <div class="font-bold text-slate-900">${i.brand}</div>
        <div class="text-[10px] text-slate-500">${i.line}</div>
      </td>
      <td class="p-3">${i.flavour}</td>
      <td class="p-3 text-right font-bold">${i.qty}</td>
    </tr>
  `).join("");

  const text = [
    "ðŸ§¾ Vape Order",
    "",
    ...order.map((i, idx) => 
      `${idx + 1}) ${i.brand} ${i.line}\n` +
      `    â€¢ ${i.category}\n` +
      `    â€¢ ${i.flavour}\n` +
      `    â€¢ Qty > ${i.qty}\n`
    )
  ].join("\n");

  orderOutput.value = text;
}

function copyOrder() {
  if (order.length === 0) return;
  orderOutput.select();
  document.execCommand("copy");
  
  msgContainer.classList.remove("hidden");
  msg.textContent = "Copied to clipboard!";
  
  setTimeout(() => {
    msgContainer.classList.add("hidden");
  }, 3000);
}

init();
</script>

</body>
</html>
